<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chatbot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="dark-mode">
    <button id="toggle-mode-btn" class="toggle-button"><i class="fas fa-sun"></i></button>
    <div class="button-container">
        <h5>Find studies on:</h5>
        <button class="query-btn" data-query="What are some major findings of lung disease research in women?">lung disease in women</button>
        <button class="query-btn" data-query="Find recent studies on cocaine addiction">cocaine addiction</button>
        <button class="query-btn" data-query="Is anyone investigating sleep and cancer?">sleep and cancer</button>
    </div>
    <div class="chat-container">
        <div class="chat-box" id="chat-box">
            <div class="chat-message bot-message">Hello! What can I help you find today?</div>
        </div>
        <div class="chat-input-container">
            <input type="text" id="user-input" placeholder="e.g. 'find studies on sleep', 'who is studying cocaine addiction?', 'is anyone looking at COPD in women?', etc." autofocus>
            <button id="send-btn">Send</button>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            function sendMessage(message) {
                $('#chat-box').append('<div class="chat-message user-message">' + message + '</div>');
                $('#user-input').val('');

                // Add the spinner
                var spinner = '<div class="chat-message bot-message spinner"><i class="fas fa-circle-notch fa-spin"></i></div>';
                $('#chat-box').append(spinner);

                $.post('/get_response', { message: message }, function (data) {
                    // Remove the spinner
                    $('#chat-box .spinner').remove();
                    $('#chat-box').append('<div class="chat-message bot-message">' + data.response + '</div>');
                    $('#chat-box').scrollTop($('#chat-box')[0].scrollHeight); // Auto-scroll to the bottom
                });
            }

            $('#send-btn').click(function () {
                var userMessage = $('#user-input').val();
                if (userMessage.trim() !== '') {
                    sendMessage(userMessage);
                }
            });

            $('.query-btn').click(function () {
                var query = $(this).data('query');
                sendMessage(query);
            });

            $('#user-input').keypress(function (e) {
                if (e.which == 13) { // Enter key pressed
                    $('#send-btn').click();
                }
            });

            $('#toggle-mode-btn').click(function () {
                $('body').toggleClass('dark-mode light-mode');
                $('i', this).toggleClass('fa-sun fa-moon');
            });
        });
    </script>
</body>
</html>
